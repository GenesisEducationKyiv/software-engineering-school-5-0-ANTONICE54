# Alerts

## Email Service

### Високий рівень помилок відправки

Алерт спрацьовує, якщо кількість невдалих відправлень сильно перевищує успішні (emails_failed_total / (emails_sent_total + 1) > 0.3) за останні 5 хвилин.
Це може вказувати на проблеми з SMTP або некоректні емейли.

## Gateway Service

### Високий час відповіді

Якщо 95й персентиль http_request_duration_seconds перевищує 2 секунди на будь-якому з ендпоїнтів, то це свідчить про проблеми з продуктивністю або зовнішніми залежностями.

### Різке збільшення запитів

Якщо кількість запитів на /subscribe або /weather зростає більше ніж у 5 разів порівняно з середнім за попередню годину - можлтво це спроба атаки.



## Subscription Service

### Низький рівень підтверджень підписки

Якщо співвідношення subscriptions_confirmed_total / (subscriptions_created_total + 1) падає нижче 0.5 - це може вказувати на те, що листи не доходять до користувача, користувач не зрозумів як підтвердити підписку або що лінк на підписку формується неправильно.





## Weather Service

### Різке збільшення кількості помилок кешу

Якщо weather_cache_errors_total різко зростає - weather_cache_errors_total / (weather_cache_errors_total + weather_cache_hits_total + weather_cache_misses_total) > 0.05, то це вказує на проблеми з Redis або на проблеми в процесі кешування.

### Високий cache miss rate

Якщо відношення weather_cache_misses_total / (weather_cache_hits_total + weather_cache_misses_total) перевищує 0.8, то це може вказувати на те, що у нас погано налаштований TTL або надто часті запити на отримання погоди до нових міст.



## Weather Broadcast Service

### Повільна швидкість розсилки

Якщо weather_broadcast_duration_seconds для daily або hourly перевищує 5 хвилин - можливо в процесі виникають якісь помилки або його потрібно оптимізувати.






# Log Retention

## Info Logs

Інформаційні логи дають можливість переглянути основні події, що відбувались в додатку. Вони є для нас важливими, адже за ними ми можемо відслітковувати стан сервісів, стан відпрацьовування певних просеців, а також бізнес події. Їх варто зберігати 30 днів - цього терміну достатньо для дослідження місячних трендів та бізнес-метрик, а також для збору статистики роботи сервісів для формування звітності.

## Warn Logs

Ці логи попереджають про некритичні відхилення від нормального робочого процесу. Вони допомагають виявляти потенційні проблеми до того, як вони стануть критичними. Їх варто зберігати 90 днів - за цей час можна виявити якісь довгострокові патерни відхилення від нормального виконання процесів та виявити чи переростають ці попередження в серйозні проблеми.

## Error Logs

Даний рівень логування сигналізує про те, що якийсь важливий функціонал в системі не відпрацював коректно(не здійснився запит до бд, не відправився лист на пошту і т.п.). Ці логи критичні для розслідування інцидентів. Їх варто зберігати 180 днів. Error логи потребують найдовшого зберігання, адже серйозі помилки можуть досліджуватись тривалий час.

## Debug Logs

Цей рівень логування надає найбільш детальну інформацію про внутрішню роботу додатку. Він використовується для детального налагодження як в розробці, так і в продакшені при розслідуванні складних проблем. Їх варто зберігати не більше 3 днів через те, що вони займають найбільший об'єм та призначені для налагодження негайних проблем, а довше їх зберігання збільшує витрати на сховище без практичної користі.


## Видалення та архівування
Debug та Info логи можна видаляти після завершення терміну зберігання, а Warn та Error логи перед видаленням варто архівувати у холодне сховище для можливого майбутнього доступу при дослідженні проблем.